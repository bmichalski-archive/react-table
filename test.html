<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React table test</title>
    <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.css" />
    <script type="text/javascript" src="node_modules/react/dist/react.js"></script>
    <script type="text/javascript" src="node_modules/react-dom/dist/react-dom.js"></script>
    <script type="text/javascript" src="node_modules/react-router/umd/ReactRouter.js"></script>
    <script type="text/javascript" src="node_modules/underscore/underscore.js"></script>
    <script type="text/javascript" src="node_modules/babel-standalone/babel.js"></script>
    <script type="text/javascript" src="node_modules/bluebird/js/browser/bluebird.js"></script>
    <script type="text/javascript" src="dist/Table.min.js"></script>
    <style type="text/css">
        .pagination > li.current > a {
            background-color: #eee;
        }

        .pagination > li > a {
            min-width: 50px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="row-clicked">Row clicked: </div>
    <div id="main-container" class="container-fluid"></div>
    <script type="text/babel">
        //Make fake getData result
        function makeRow(data, tds) {
            return {
                onClick: (row, i) => {
                    document.getElementById('row-clicked').innerHTML = 'Row clicked: ' + i
                },
                data: data,
                tds: tds
            }
        }

        function makeResult() {
            const result = [
                makeRow(
                    { foo: 'bar' },
                    [
                        {
                            content: 0
                        },
                        {
                            content: 'Foo'
                        },
                        {
                            content: 'Bar'
                        }
                    ]
                ),
                makeRow(
                    { baz: 'qux' },
                    [
                        {
                            content: 1
                        },
                        {
                            content: 'Baz'
                        },
                        {
                            content: 'Qux'
                        }
                    ]
                ),
                makeRow(
                    { baz: 'qux' },
                    [
                        {
                            content: 2
                        },
                        {
                            content: React.createElement('i', { className: 'glyphicon glyphicon-ok' })
                        },
                        {
                            content: React.createElement('i', { className: 'glyphicon glyphicon-star' })
                        }
                    ]
                )
            ]

            for(var i = 3; i < 153; i += 1) {
                result.push(
                    makeRow(
                        { foo: 'bar' },
                        [
                            {
                                content: i
                            },
                            {
                                content: 'Foo'
                            },
                            {
                                content: 'Bar'
                            }
                        ]
                    )
                )
            }

            return result
        }
        //End make fake getData result

        const result = makeResult()

        const Router = ReactRouter.Router
        const Route = ReactRouter.Route

        class TableWrapper extends React.Component {
            render() {
                const paginator = {
                    navigateToPage: (link) => {
                        ReactRouter.browserHistory.push(link)
                    },
                    makeLink: (page, pageSize) => {
                        return ReactRouter.browserHistory.createPath(
                            {
                                pathname: this.props.location.pathname,
                                query: _.extend({}, this.props.location.query, { page: page, pageSize: pageSize })
                            }
                        )
                    }
                }

                const getData = (page, pageSize) => {
                    const from = (page - 1) * pageSize
                    const end = from + pageSize

                    return new Promise((resolve) => {
                        resolve({
                            result: result.slice(from, end),
                            info: {
                                total: result.length * 2,
                                totalFiltered: result.length
                            }
                        })
                    })
                }

                return (
                    <Table
                        page={undefined === this.props.location.query.page ? undefined : parseInt(this.props.location.query.page, 10)}
                        pageSize={undefined === this.props.location.query.pageSize ? undefined : parseInt(this.props.location.query.pageSize, 10)}
                        paginator={paginator}
                        getData={getData}>
                        <TableHead>
                            <TableHeadRow>
                                <TableHeadTh>Id</TableHeadTh>
                                <TableHeadTh>First column</TableHeadTh>
                                <TableHeadTh>Second column</TableHeadTh>
                            </TableHeadRow>
                        </TableHead>
                    </Table>
                )
            }
        }

        const router = (
            <Router history={ReactRouter.browserHistory}>
                <Route path="/" component={TableWrapper}>
                    <Route path="*" component={TableWrapper} />
                </Route>
            </Router>
        )

        ReactDOM.render(
            router,
            document.getElementById('main-container')
        )
    </script>
</body>
</html>
