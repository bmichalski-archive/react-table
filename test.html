<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React table test</title>
    <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.css" />
    <script type="text/javascript" src="node_modules/react/dist/react.js"></script>
    <script type="text/javascript" src="node_modules/react-dom/dist/react-dom.js"></script>
    <script type="text/javascript" src="node_modules/react-router/umd/ReactRouter.js"></script>
    <script type="text/javascript" src="node_modules/underscore/underscore.js"></script>
    <script type="text/javascript" src="node_modules/babel-standalone/babel.js"></script>
    <script type="text/javascript" src="node_modules/bluebird/js/browser/bluebird.js"></script>
    <script type="text/javascript" src="dist/Table.min.js"></script>
    <style type="text/css">
        .pagination > li.current > a {
            background-color: #eee;
        }

        .pagination > li > a {
            min-width: 50px;
            text-align: center;
        }

        .table > tbody > tr > td {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="row-clicked">Row clicked: </div>
    <div id="main-container" class="container-fluid"></div>
    <script type="text/babel">
        const result = (() => {
            const result = [
                [
                    {
                        content: 0
                    },
                    {
                        content: 'Foo'
                    },
                    {
                        content: 'Bar'
                    }
                ],
                [
                    {
                        content: 1
                    },
                    {
                        content: 'Baz'
                    },
                    {
                        content: 'Qux'
                    }
                ],
                [
                    {
                        content: 2
                    },
                    {
                        content: React.createElement('i', { className: 'glyphicon glyphicon-ok' })
                    },
                    {
                        content: React.createElement('i', { className: 'glyphicon glyphicon-star' })
                    }
                ]
            ]

            for(var i = 3; i < 153; i += 1) {
                result.push(
                    [
                        {
                            content: i
                        },
                        {
                            content: 'Foo'
                        },
                        {
                            content: 'Bar'
                        }
                    ]
                )
            }

            return result
        })()

        const Router = ReactRouter.Router
        const Route = ReactRouter.Route

        class TableWrapper extends React.Component {
            render() {
                const paginator = {
                    goToPage: (link) => {
                        ReactRouter.browserHistory.push(link)
                    },
                    makeLink: (page, pageSize) => {
                        return ReactRouter.browserHistory.createPath(
                            {
                                pathname: this.props.location.pathname,
                                query: _.extend({}, this.props.location.query, { page: page, pageSize: pageSize })
                            }
                        )
                    }
                }

                const page = undefined === this.props.location.query.page ? 1 : parseInt(this.props.location.query.page, 10)
                const pageSize = undefined === this.props.location.query.pageSize ? 10 : parseInt(this.props.location.query.pageSize, 10)

                const getData = () => {
                    const from = (page - 1) * pageSize
                    const end = from + pageSize

                    return new Promise((resolve) => {
                        resolve({
                            result: result.slice(from, end),
                            info: {
                                total: result.length * 2,
                                totalFiltered: result.length
                            }
                        })
                    })
                }


                const onRowClicked = (data, rowIndex) => {
                    const str = JSON.stringify({ rowIndex: rowIndex, data: data })

                    document
                        .getElementById('row-clicked')
                        .innerHTML = 'Row clicked: ' + str
                }

                return (
                    <Table
                        page={page}
                        pageSize={pageSize}
                        paginator={paginator}
                        onRowClicked={onRowClicked}
                        getData={getData}
                        renderCell={(data) => { return data.content }}>
                        <TableHead>
                            <TableHeadRow>
                                <TableHeadTh>Id</TableHeadTh>
                                <TableHeadTh>First column</TableHeadTh>
                                <TableHeadTh>Second column</TableHeadTh>
                            </TableHeadRow>
                        </TableHead>
                    </Table>
                )
            }
        }

        const router = (
            <Router history={ReactRouter.browserHistory}>
                <Route path="/" component={TableWrapper}>
                    <Route path="*" component={TableWrapper} />
                </Route>
            </Router>
        )

        ReactDOM.render(
            router,
            document.getElementById('main-container')
        )
    </script>
</body>
</html>
